# 安装

推荐使用 Typecho 的最新正式版本安装本插件，并采用 PHP 7x 作为生产环境。

## 全新安装

从 [GitHub](https://github.com/Dreamer-Paul/Pio) 上获取本项目。

将插件压缩包上传到你的网站。Typecho 插件的默认存放路径在 `/usr/plugins`

解压主题的压缩包文件，默认得到一个文件夹，应该为 `Pio-master`

将文件夹更名为 `Pio` 以确保插件可以正常工作

登录你的 Typecho 后台，在导航栏找到 **控制台** > **插件** > **Pio** > **启用**

## 更新安装

打开插件的选项，将里面的设置内容逐一拷贝到记事本。

禁用本插件，并删除旧版插件原有的文件。

按照全新安装的步骤获取压缩包并安装。

将记事本内的设置内容逐一填入插件设置的文本框内。


# 常见问题

> 插件无法启用，Typecho 提示插件不存在

答：请确认插件文件夹名称修改为 `Pio` 而不是 `Pio-master`

> 插件成功启用，打开网站发现没有显示看板娘

答：如果你使用的是 IIS 服务器/基于 IIS 的虚拟机空间，则为缺少 MIME 导致。详见本 [Issue](https://github.com/Dreamer-Paul/Pio/issues/1)。

如果你使用的是 VPS 服务器，同时模型地址与站点地址不同，请参阅下面的 “如何设置跨域访问” 问题。

如果你的网站是虚拟空间搭建的，同时采用 CNAME 解析或是开启了部分主机商的“加速”选项。则是由于实际域名与站点域名不同，跨域访问被阻止。这种情况只能联系或更换服务商，或是采用其他人的支持跨域使用的看板娘 API。（我本来也想做的但是缺经费，Emmm... ~~点击上方赞助为我加油~~）


还有一种情况就是你使用的模板存在 Bug，症状为所有在前端显示的插件均失效。这种情况你可以联系作者修复，或是自己修改模板函数文件 `function.php` 并添加下面的函数。

```php
<?php $this -> footer(); ?>
```

> 如何设置跨域访问

如果你使用的不是虚拟空间而是自己的 VPS 服务器，同时打算多域名使用，最简单的方法就是改回同域名，将模型放在插件的 `models` 文件夹内。你还可以通过修改 Nginx 的站点配置解决。

```bash
location ^~ 你的站点路径
{
    add_header Access-Control-Allow-Origin 允许访问的网站地址，包括协议;
}
```

例如你的看板娘模型在 `www.paul.com/model`，并只能允许 `paugram.com` 访问

```bash
location ^~ /model
{
    add_header Access-Control-Allow-Origin https://paugram.com;
}
```

> 鼠标移动到特定区域后没有任何文字提示

答：IE9 以下浏览器不支持 `querySelectorAll` 方法，因此无法显示。请升级你的浏览器！

> 我使用的模板有 PJAX，切换页面之后看板娘无法显示或报错

答：在你模板的设置选项找到重载设置，通过本插件的 [重载方法](?id=重载函数（21-新增）) 进行重载。还有一种极端方法就是直接关闭 PJAX 功能。

> 想要我博客现用的模型？还有更多？

答：去我自己搭建的 [梦象模型站](https://mx-model.ga) 或是加我的群找我要吧！千万别引用我这个小水管的地址啊 😉

> 我有在其他渠道获取的模型，如何使用？

答：你可以在插件设置里面选择使用外链方法载入模型（[自定配置文件](?id=自定配置文件)），或是将自己的模型放在插件的 `models` 文件夹内（[选择模型](?id=选择模型)），确保每个模型放在单独的一个文件夹，并且模型配置文件以 `model.json` 命名。以下是示例结构：

```
plugins/Pio/models
 ┌ pio（模型名称）
 ├─ motions（动作文件）
 ├─ textures（贴图文件）
 ├─ model.moc（配置文件）
 └─ model.json（配置文件）
```

> 点击页面或模型，控制台就会出现报错

答：这是由于模型的 `model.json` 缺少 `hit_areas_custom` 属性导致的，目前比较常见的报错是下面这种。你可以手动添加相关代码进行修复。

```javascript
l2d.js:1 Uncaught TypeError: Cannot read property '0' of undefined
    at o.r.hitTestSimpleCustom (l2d.js:1)
    at o.hitTestCustom (l2d.js:1)
    at o.tapEvent (l2d.js:1)
    at p (l2d.js:1)
    at g (l2d.js:1)
```

在 `model.json` 添加下列代码即可解决。

```json
"hit_areas_custom":{
    "head_x":[-0.35, 0.6],
    "head_y":[0.19, -0.2],
    "body_x":[-0.3, -0.25],
    "body_y":[0.3, -0.9]
}
```

> 其他问题

如果上述内容不符合你所遇到的问题，请加入我的企鹅群（[657692292](https://jq.qq.com/?_wv=1027&k=4Buhabv)）联系群主即时提问交流，也可在 GitHub 的 [Issues](https://github.com/Dreamer-Paul/Pio/issues) 区提出。


# 后台设置

## 选择模型

这里的模型均位于 `插件目录/models` 文件夹，并且所有模型的配置文件名必须为 `model.json` 才可以正常使用。

## 自定位置

可选靠左或靠右，根据你所使用的主题布局来进行决定。

## 自定宽高

如果你在 [梦象](https://mx-model.ga) 下载模型，一般会给你推荐高宽。按照这个填入即可，无需 `px` 单位。如果没有推荐高宽，你可以自行修改测试。修改成功后看板娘就不会出现显示不全的问题啦！

## 自定配置文件

用于使用外链模型。填写该选项后，上面选择的模型均无效。前台仅显示这里填写的一个模型。

## 夜间模式函数

用于切换主题的夜间模式。如果你的主题支持切换夜间模式，在这里填写对应的方法可以在看板娘中点击按钮进行调用。例如在 `Single` 主题下，其夜间模式切换方法为 `single.night()`

## 展现模式

 - **静态**：只保留看板娘自身和文字提示，适合所有模型。
 - **固定**：固定看板娘的位置，增加功能按钮，适合所有模型。
 - **可移动**：看板娘的位置可以被用户更改，也保留了功能按钮，不适合半身模型。

## 隐藏看板娘

用于控制是否在移动设备上隐藏看板娘。可以改善部分低配设备的浏览性能。

## 时间小贴士

用于在指定时间展示对应的生活小贴士，如果开启将覆盖入站提示内容。

## 自定提示内容

后台设置的提示内容和内容选择器需要自行填写 JSON，如果需要保持默认则需要填写 “{}”

> 从 2.1 版本开始增加了检测功能，如选项留空会自动进行补全。

提示内容一共有以下几个参数可以自行设置，如不额外设置参数则为插件默认的提示文字，按照自己的需求填写即可覆盖默认设置。

- `welcome`：欢迎入站的信息
- `article`：设置鼠标移入文章标题时的提示内容，`%t` 为文章标题
- `touch`：点击~~触摸~~看板娘时随机提示的文字
- `skin`：鼠标移入切换皮肤 / 人物按钮时的提示文字
- `home`：鼠标移入进入首页按钮的提示文字
- `close`：鼠标移入关闭看板娘按钮的提示文字
- `link`：关于本站按钮的跳转链接（2.1 更新）
- `referer`：当访客通过其他来源访问站点时的提示内容，`%t` 为来源网站（2.1 更新）
- `custom`：自定义元素及提示

### 示例

提示内容最全可以写成这样，当然你可以把这段复制下来自己研究和修改。

```json
{
    "welcome": ["你好，欢迎来到保罗的小窝", "我是从云，傲完就娇的从云~"],
    "article": "想阅读 %t 吗？",
    "touch": ["你这个绅士！", "别碰我！"],
    "skin": ["想看看我的新服装吗？", "新衣服真漂亮~"],
    "home": "点击这里进入首页！",
    "link": "https://paul.ren/about",
    "close": "QWQ 下次再见吧~",
    "referer": ["你通过 %t 来到了这里", "欢迎你在 %t 的指引下来到这里~"],
    "custom": [
        {
            "s": "#textarea",
            "t": ["欢迎参与本文评论，别发小广告噢~", "快来参加本文的评论吧~"]
        }
    ]
}
```

下面是各项参数的详细说明：

### welcome

【2.1 版本及以上】允许字符串或数组，用于用户进站提示。不填本参数则为默认输出。

```json
默认："欢迎来到本站！"
示例："欢迎来到保罗的博客！"、["欢迎来到保罗的小窝", "我是从云，傲完就娇的从云~"] 或不填本参数。
```

【2.0 版本】只允许数组，用于用户进站提示。里面有两个项目，分别是直接进站和跳转入站的文字内容。其中 `%t` 是来源站点，第一项必填，不填则为默认输出。

```json
默认：["欢迎来到保罗的博客！", "欢迎来自 %t 的朋友！"]
示例：["欢迎来到保罗的博客！"]、["欢迎来到保罗的小窝", "我是从云，傲完就娇的从云~"] 或不填本参数。
```

### article

只允许字符串，填写当鼠标移入选择器指定的文章链接时看板娘的提示内容，不填则为默认输出。

- `%t`：链接文字

```json
默认："想阅读 %t 吗？"
示例："想阅读 %t 吗？" 或不填本参数。
```

### touch

允许字符串或数组，填写点击看板娘的提示内容。不填本参数则为默认输出。

```json
默认：["你在干什么？", "再摸我就报警了！", "HENTAI!", "你够了喔！"]
示例："别碰我！"、["你在干什么？", "萝莉是什么呀"] 或不填。
```

### skin

只允许数组，用于用户更换皮肤或模型。里面有两个项目，分别是点击更换的提示和更换完成后的提示。不填本参数则为默认输出。

```json
默认：["想看看我的新衣服吗？", "新衣服真漂亮~"]
示例：["要让我的朋友上阵吗？", "让她休息一会儿吧~"] 或 ["要让我的朋友上阵吗？"]
```

### home

允许字符串或数组，填写点击返回首页按钮时看板娘的提示内容。不填本参数则为默认输出。

```json
默认："点击这里回到首页！"
示例：["点击这里回到首页！", "让我们回家吧！"]
```

### close

允许字符串或数组，填写点击关闭看板娘按钮的提示内容。不填本参数则为默认输出。

```json
默认："QWQ 下次再见吧~"
示例：["Bye! ", "下次再见吧~"]
```

### link（2.1 新增）

允许字符串，用于修改“关于”按钮的链接地址。不填本参数则为默认输出。

```json
默认："https://paugram.com/coding/add-poster-girl-with-plugin.html"
示例："https://paul.ren/about"
```

### referer（2.1 新增）

允许字符串，用于修改其他来源进站的提示。不填本参数则为默认输出。

- `%t`：来源站点地址

```json
默认："欢迎来自 %t 的朋友！"
示例："Hi，欢迎你在 %t 的指引下来到这里~"
```

### custom（2.2 新增）

只允许数组，用于扩展看板娘的自定义提示内容。当鼠标移入指定的元素，将提示对应的内容。不填则不启用该功能。


```json
{
    "s": "#textarea",
    "t": "欢迎参与本文评论，别发小广告噢~"
},
{
    "s": ".home-social a:last-child",
    "t": "在这里可以了解博主的日常噢~"
}
```

## 自定内容选择器

内容选择器用于选择需要和看板娘实现交互所需要的网页元素。若要在鼠标移入 / 点击网页元素时实现看板娘的部分交互功能，需要在此指定你主题的元素 CSS 选择器。

- `articles`：文章阅读提示

### 示例

像下面这样的 HTML 结构，我们只需要填写 `.post-item h3` 即可完成该选择器的配置。如果不填该参数则没有文章提示功能。

```html
<div class="post-item">
    <a href="post.html">
        <h3>这是一个文章</h3>
    </a>
</div>
```

对应的 JSON 配置也就是这样：

```json
{
    "articles": ".post-item h3"
}
```

下面是各项参数的详细说明：

### articles

只允许字符串，用于看板娘在鼠标移入文章链接时的提示内容，当鼠标移入指定的文章链接，将提示是否阅读此文章。不填则不启用该功能。

```json
示例：".post-item h3"
```


# 方法

## 重载函数（2.1 新增）

如果你的主题有 PJAX 功能，可使用以下方法重载本插件。

```javascript
pio.init()
```